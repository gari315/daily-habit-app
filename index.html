<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>„É©„É≥„ÉÄ„É†„Çø„Çπ„ÇØÁÆ°ÁêÜ</title>
  <style>
    :root {
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --text-main: #e0e0e0;
      --text-dim: #a0a0a0;
      --accent: #3d5afe;
      --success: #00c853;
      --warning: #ffd600;
      --danger: #ff5252;
      --border: #333;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    header h1 {
      font-size: 2rem;
      letter-spacing: 4px;
      margin: 0 0 10px 0;
      color: var(--accent);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-dim);
      letter-spacing: 2px;
    }

    .habit-btn {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--success);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .habit-btn:hover {
      filter: brightness(1.2);
      transform: scale(1.05);
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-item {
      background: var(--card-bg);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-dim);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }

    .task-display {
      margin-bottom: 30px;
    }

    .card {
      background: var(--card-bg);
      width: 100%;
      min-height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      border: 1px solid var(--border);
      transition: transform 0.3s ease;
      margin-bottom: 20px;
      word-break: break-word;
    }

    .main-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btn {
      padding: 16px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-primary {
      background-color: var(--accent);
      color: white;
    }

    .btn-success {
      background-color: transparent;
      color: var(--success);
      border: 2px solid var(--success);
    }

    .btn-warning {
      background-color: transparent;
      color: var(--warning);
      border: 2px solid var(--warning);
    }

    .btn-danger {
      background-color: transparent;
      color: var(--danger);
      border: 2px solid var(--danger);
    }

    .btn:hover {
      filter: brightness(1.2);
      transform: scale(1.02);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-success:hover {
      background-color: var(--success);
      color: #000;
    }

    .btn-warning:hover {
      background-color: var(--warning);
      color: #000;
    }

    .btn-danger:hover {
      background-color: var(--danger);
      color: #fff;
    }

    .lists-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .list-section {
      display: flex;
      flex-direction: column;
    }

    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .list-section h2 {
      font-size: 0.9rem;
      color: var(--text-dim);
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
      margin: 0;
      flex-grow: 1;
    }

    .add-task-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      margin-left: 10px;
    }

    .scroll-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .scroll-list li {
      background: var(--card-bg);
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 0.85rem;
      border: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .task-info {
      flex-grow: 1;
      word-break: break-word;
    }

    .task-buttons {
      display: flex;
      gap: 4px;
    }

    .scroll-list li button {
      background: var(--accent);
      border: none;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.7rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .scroll-list li button.delete-btn {
      background: var(--danger);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid var(--border);
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-content h3 {
      margin-top: 0;
      color: var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .today-badge {
      background: var(--success);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: normal;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      background: var(--bg-color);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-main);
      font-size: 1rem;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
    }

    .modal-buttons button {
      flex: 1;
    }

    .habit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .habit-item {
      background: var(--bg-color);
      padding: 14px 16px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s ease;
    }

    .habit-item:hover {
      border-color: var(--accent);
    }

    .habit-item.completed {
      opacity: 0.6;
      background: var(--card-bg);
    }

    .habit-checkbox {
      width: 24px;
      height: 24px;
      min-width: 24px;
      cursor: pointer;
      accent-color: var(--success);
    }

    .habit-text {
      flex-grow: 1;
      font-size: 0.95rem;
    }

    .habit-item.completed .habit-text {
      text-decoration: line-through;
      color: var(--text-dim);
    }

    .habit-progress {
      margin-top: 20px;
      padding: 15px;
      background: var(--bg-color);
      border-radius: 8px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .habit-progress-text {
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 8px;
    }

    .habit-progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .habit-progress-fill {
      height: 100%;
      background: var(--success);
      transition: width 0.3s ease;
    }

    @media (max-width: 600px) {
      .container {
        padding: 15px;
      }

      header h1 {
        font-size: 1.5rem;
      }

      .habit-btn {
        position: static;
        margin-top: 10px;
        width: 100%;
      }

      .card {
        min-height: 150px;
        font-size: 1.1rem;
        padding: 20px;
      }

      .lists-container {
        grid-template-columns: 1fr;
      }

      .stats {
        gap: 10px;
      }

      .stat-item {
        padding: 8px 16px;
      }

      .stat-value {
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>„É©„É≥„ÉÄ„É†„Çø„Çπ„ÇØ</h1>
      <p class="subtitle">‰∏Ä„Å§„ÅÆ„Åì„Å®„Å´ÈõÜ‰∏≠„Åô„Çã</p>
      <button class="habit-btn" id="habitBtn">üìÖ ‰ªäÊó•„ÅÆÁøíÊÖ£</button>
    </header>

    <div class="stats">
      <div class="stat-item">
        <div class="stat-label">ÊÆã„Çä„Çø„Çπ„ÇØ</div>
        <div class="stat-value" id="remainingCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ÂÆå‰∫Ü„Çø„Çπ„ÇØ</div>
        <div class="stat-value" id="completedCount">0</div>
      </div>
    </div>

    <section class="task-display">
      <div id="currentTask" class="card">Ê∫ñÂÇô„ÅØ„ÅÑ„ÅÑ„Åß„Åô„Åã?</div>
      <div class="main-buttons">
        <button id="drawBtn" class="btn btn-primary">„Çø„Çπ„ÇØ„ÇíÂºï„Åè</button>
        <div class="action-buttons">
          <button id="execBtn" class="btn btn-success">ÂÆüË°åÂÆå‰∫Ü</button>
          <button id="skipBtn" class="btn btn-warning">„Çπ„Ç≠„ÉÉ„Éó</button>
        </div>
      </div>
    </section>

    <div class="lists-container">
      <section class="list-section">
        <div class="list-header">
          <h2>„Çø„Çπ„ÇØ‰∏ÄË¶ß</h2>
          <button class="add-task-btn" id="addTaskBtn">+ ËøΩÂä†</button>
        </div>
        <ul id="taskList" class="scroll-list"></ul>
      </section>

      <section class="list-section">
        <div class="list-header">
          <h2>„Ç¥„ÉüÁÆ±</h2>
        </div>
        <ul id="trashList" class="scroll-list"></ul>
      </section>
    </div>
  </div>

  <!-- „Çø„Çπ„ÇØËøΩÂä†/Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">„Çø„Çπ„ÇØ„ÇíËøΩÂä†</h3>
      <div class="form-group">
        <label for="taskInput">„Çø„Çπ„ÇØÂêç</label>
        <input type="text" id="taskInput" placeholder="‰æã: Êï∞Â≠¶„ÅÆÂÆøÈ°å„Çí„Åô„Çã">
      </div>
      <div class="modal-buttons">
        <button class="btn btn-success" id="saveTaskBtn">‰øùÂ≠ò</button>
        <button class="btn btn-danger" id="cancelTaskBtn">„Ç≠„É£„É≥„Çª„É´</button>
      </div>
    </div>
  </div>

  <!-- ÁøíÊÖ£„É¢„Éº„ÉÄ„É´ -->
  <div id="habitModal" class="modal">
    <div class="modal-content">
      <h3>
        <span id="habitDayName">‰ªäÊó•„ÅÆÁøíÊÖ£</span>
        <span class="today-badge" id="todayDate"></span>
      </h3>
      <div class="habit-progress">
        <div class="habit-progress-text" id="habitProgressText">0 / 0 ÂÆå‰∫Ü</div>
        <div class="habit-progress-bar">
          <div class="habit-progress-fill" id="habitProgressFill" style="width: 0%"></div>
        </div>
      </div>
      <ul id="habitList" class="habit-list"></ul>
      <div class="modal-buttons">
        <button class="btn btn-primary" id="closeHabitBtn">Èñâ„Åò„Çã</button>
      </div>
    </div>
  </div>

  <script>
    // ÁøíÊÖ£„Éá„Éº„ÇøÂÆöÁæ©
    const HABITS = [
      "„Éê„ÇπÂæÄË∑Ø(Leap)",
      "„Éê„ÇπÂæ©Ë∑Ø(Leap)",
      "Êúù„ÉÜ„Çπ„ÉàÁ¢∫Ë™ç(„Éê„Çπ)",
      "Êúù„ÉÜ„Çπ„ÉàÂãâÂº∑",
      "Vintage„Éé„Éº„Éà",
      "Vintage„ÅÆÁØÑÂõ≤ÁêÜËß£"
    ];

    // ÊõúÊó•Âà•ÁøíÊÖ£„Éû„ÉÉ„Éî„É≥„Ç∞ (0=Êó•Êõú, 1=ÊúàÊõú, ..., 6=ÂúüÊõú)
    const DAY_HABITS = {
      0: [3],           // Êó•ÊõúÊó•
      1: [2, 3],        // ÊúàÊõúÊó•
      2: [2, 4],        // ÁÅ´ÊõúÊó•
      3: [0, 1, 3],     // Ê∞¥ÊõúÊó•
      4: [2, 3],        // Êú®ÊõúÊó•
      5: [2, 4],        // ÈáëÊõúÊó•
      6: [4, 5]         // ÂúüÊõúÊó•
    };

    const DAY_NAMES = ["Êó•ÊõúÊó•", "ÊúàÊõúÊó•", "ÁÅ´ÊõúÊó•", "Ê∞¥ÊõúÊó•", "Êú®ÊõúÊó•", "ÈáëÊõúÊó•", "ÂúüÊõúÊó•"];

    // „Éá„Éº„ÇøÊßãÈÄ†
    let tasks = [];
    let trash = [];
    let currentTask = null;
    let completedCount = 0;
    let editingTaskIndex = null;
    let habitCompletions = {};

    // DOMË¶ÅÁ¥†
    const currentTaskDiv = document.getElementById("currentTask");
    const taskList = document.getElementById("taskList");
    const trashList = document.getElementById("trashList");
    const remainingCountEl = document.getElementById("remainingCount");
    const completedCountEl = document.getElementById("completedCount");
    const taskModal = document.getElementById("taskModal");
    const habitModal = document.getElementById("habitModal");
    const modalTitle = document.getElementById("modalTitle");
    const taskInput = document.getElementById("taskInput");
    const habitList = document.getElementById("habitList");
    const habitDayName = document.getElementById("habitDayName");
    const todayDate = document.getElementById("todayDate");
    const habitProgressText = document.getElementById("habitProgressText");
    const habitProgressFill = document.getElementById("habitProgressFill");

    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
    document.getElementById("drawBtn").addEventListener("click", drawTask);
    document.getElementById("execBtn").addEventListener("click", executeTask);
    document.getElementById("skipBtn").addEventListener("click", skipTask);
    document.getElementById("addTaskBtn").addEventListener("click", openAddModal);
    document.getElementById("saveTaskBtn").addEventListener("click", saveTask);
    document.getElementById("cancelTaskBtn").addEventListener("click", closeTaskModal);
    document.getElementById("habitBtn").addEventListener("click", openHabitModal);
    document.getElementById("closeHabitBtn").addEventListener("click", closeHabitModal);

    // ÂàùÊúüÂåñ
    function init() {
      loadData();
      renderLists();
      updateStats();
      checkNewDay();
    }

    // Êó•‰ªò„ÅåÂ§â„Çè„Å£„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    function checkNewDay() {
      const today = new Date().toDateString();
      const lastDate = localStorage.getItem("lastHabitDate");

      if (lastDate !== today) {
        habitCompletions = {};
        localStorage.setItem("lastHabitDate", today);
        saveData();
      }
    }

    // „Éá„Éº„Çø‰øùÂ≠ò
    function saveData() {
      const data = {
        tasks: tasks,
        trash: trash,
        completedCount: completedCount,
        habitCompletions: habitCompletions
      };
      try {
        localStorage.setItem("taskManagerData", JSON.stringify(data));
      } catch (e) {
        console.log("‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
      }
    }

    // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
    function loadData() {
      try {
        const saved = localStorage.getItem("taskManagerData");
        if (saved) {
          const data = JSON.parse(saved);
          tasks = data.tasks || [];
          trash = data.trash || [];
          completedCount = data.completedCount || 0;
          habitCompletions = data.habitCompletions || {};
        } else {
          // ÂàùÊúü„Éá„Éº„Çø
          tasks = [
            {text: "ÂõΩË™ûÔºöÂè§ÊñáÂçòË™û", pending: 0},
            {text: "ÂõΩË™ûÔºö‰ΩìÁ≥ªÊº¢Êñá", pending: 0},
            {text: "Êï∞Â≠¶ÔºöÊïôÁßëÊõ∏Á¢∫Ë™ç", pending: 0},
            {text: "Ëã±Ë™ûÔºöVintage„Éé„Éº„Éà", pending: 0},
            {text: "Ëã±Ë™ûÔºöLeap", pending: 0},
            {text: "ÂåñÂ≠¶Ôºö„Çª„Éü„Éä„ÉºÁ¢∫Ë™ç", pending: 0},
            {text: "Âú∞ÁêÜÔºöNewCompus", pending: 0},
            {text: "Ê≠¥Âè≤ÔºöÊ≠¥Âè≤„Éé„Éº„ÉàÁ¢∫Ë™ç", pending: 0},
            {text: "ÈÉ®Â±ã„ÅÆÊéÉÈô§ÔºöÊú∫„Çí„Åç„Çå„ÅÑ„Å´„Åô„Çã", pending: 0},
            {text: "ÈÉ®Â±ã„ÅÆÊéÉÈô§Ôºö‰∫åÈöé„Çí„Åç„Çå„ÅÑ„Å´„Åô„Çã", pending: 0}
          ];
        }
      } catch (e) {
        console.log("Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
        tasks = [];
      }
    }

    // Áµ±Ë®àÊõ¥Êñ∞
    function updateStats() {
      remainingCountEl.textContent = tasks.length;
      completedCountEl.textContent = completedCount;
    }

    // „É™„Çπ„ÉàË°®Á§∫Êõ¥Êñ∞
    function renderLists() {
      // „Çø„Çπ„ÇØ‰∏ÄË¶ß
      taskList.innerHTML = "";
      tasks.forEach((t, index) => {
        const li = document.createElement("li");

        const info = document.createElement("div");
        info.className = "task-info";
        info.textContent = `${t.text}Ôºà„Çπ„Ç≠„ÉÉ„Éó:${t.pending}Ôºâ`;

        const buttons = document.createElement("div");
        buttons.className = "task-buttons";

        const editBtn = document.createElement("button");
        editBtn.textContent = "Á∑®ÈõÜ";
        editBtn.addEventListener("click", () => openEditModal(index));

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "ÂâäÈô§";
        deleteBtn.addEventListener("click", () => deleteTask(index));

        buttons.appendChild(editBtn);
        buttons.appendChild(deleteBtn);

        li.appendChild(info);
        li.appendChild(buttons);
        taskList.appendChild(li);
      });

      // „Ç¥„ÉüÁÆ±
      trashList.innerHTML = "";
      trash.forEach((t, index) => {
        const li = document.createElement("li");

        const info = document.createElement("div");
        info.className = "task-info";
        info.textContent = t.text;

        const buttons = document.createElement("div");
        buttons.className = "task-buttons";

        const restoreBtn = document.createElement("button");
        restoreBtn.textContent = "Âæ©Ê¥ª";
        restoreBtn.addEventListener("click", () => restoreTask(index));

        const permanentDeleteBtn = document.createElement("button");
        permanentDeleteBtn.className = "delete-btn";
        permanentDeleteBtn.textContent = "ÂÆåÂÖ®ÂâäÈô§";
        permanentDeleteBtn.addEventListener("click", () => permanentDeleteTask(index));

        buttons.appendChild(restoreBtn);
        buttons.appendChild(permanentDeleteBtn);

        li.appendChild(info);
        li.appendChild(buttons);
        trashList.appendChild(li);
      });

      updateStats();
    }

    // ÁøíÊÖ£„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
    function openHabitModal() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const todayHabits = DAY_HABITS[dayOfWeek] || [];

      // Êó•‰ªòË°®Á§∫
      const month = today.getMonth() + 1;
      const date = today.getDate();
      todayDate.textContent = `${month}/${date}`;
      habitDayName.textContent = `${DAY_NAMES[dayOfWeek]}„ÅÆÁøíÊÖ£`;

      // ÁøíÊÖ£„É™„Çπ„ÉàË°®Á§∫
      habitList.innerHTML = "";

      if (todayHabits.length === 0) {
        const li = document.createElement("li");
        li.className = "habit-item";
        li.style.justifyContent = "center";
        li.style.color = "var(--text-dim)";
        li.textContent = "‰ªäÊó•„ÅÆÁøíÊÖ£„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì";
        habitList.appendChild(li);

        habitProgressText.textContent = "0 / 0 ÂÆå‰∫Ü";
        habitProgressFill.style.width = "0%";
      } else {
        let completedHabits = 0;

        todayHabits.forEach(habitIndex => {
          const habitText = HABITS[habitIndex];
          const isCompleted = habitCompletions[habitIndex] || false;

          if (isCompleted) completedHabits++;

          const li = document.createElement("li");
          li.className = "habit-item";
          if (isCompleted) li.classList.add("completed");

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "habit-checkbox";
          checkbox.checked = isCompleted;
          checkbox.addEventListener("change", () => toggleHabit(habitIndex));

          const text = document.createElement("span");
          text.className = "habit-text";
          text.textContent = habitText;

          li.appendChild(checkbox);
          li.appendChild(text);
          habitList.appendChild(li);
        });

        // ÈÄ≤ÊçóË°®Á§∫
        const progress = Math.round((completedHabits / todayHabits.length) * 100);
        habitProgressText.textContent = `${completedHabits} / ${todayHabits.length} ÂÆå‰∫Ü`;
        habitProgressFill.style.width = `${progress}%`;
      }

      habitModal.classList.add("active");
    }

    // ÁøíÊÖ£„ÅÆÂÆå‰∫ÜÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
    function toggleHabit(habitIndex) {
      habitCompletions[habitIndex] = !habitCompletions[habitIndex];
      saveData();

      // „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞
      const today = new Date();
      const dayOfWeek = today.getDay();
      const todayHabits = DAY_HABITS[dayOfWeek] || [];

      let completedHabits = 0;
      todayHabits.forEach(index => {
        if (habitCompletions[index]) completedHabits++;
      });

      const progress = Math.round((completedHabits / todayHabits.length) * 100);
      habitProgressText.textContent = `${completedHabits} / ${todayHabits.length} ÂÆå‰∫Ü`;
      habitProgressFill.style.width = `${progress}%`;

      // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆË¶™Ë¶ÅÁ¥†„ÇíÊõ¥Êñ∞
      const items = document.querySelectorAll(".habit-item");
      const habitListArray = todayHabits;
      const itemIndex = habitListArray.indexOf(habitIndex);

      if (itemIndex !== -1 && items[itemIndex]) {
        if (habitCompletions[habitIndex]) {
          items[itemIndex].classList.add("completed");
        } else {
          items[itemIndex].classList.remove("completed");
        }
      }
    }

    // ÁøíÊÖ£„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
    function closeHabitModal() {
      habitModal.classList.remove("active");
    }

    // „Çø„Çπ„ÇØ„ÇíÂºï„ÅèÔºàÈáç„Åø‰ªò„Åë„É©„É≥„ÉÄ„É†Ôºâ
    function drawTask() {
      if (tasks.length === 0) {
        currentTaskDiv.textContent = "„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";
        return;
      }

      // „Çπ„Ç≠„ÉÉ„ÉóÂõûÊï∞„ÅåÂ§ö„ÅÑ„Åª„Å©ÈÅ∏„Å∞„Çå„ÇÑ„Åô„Åè„Åô„Çã
      const weights = tasks.map(t => Math.pow(2, t.pending));
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      let random = Math.random() * totalWeight;

      for (let i = 0; i < tasks.length; i++) {
        random -= weights[i];
        if (random <= 0) {
          currentTask = tasks[i];
          break;
        }
      }

      currentTaskDiv.textContent = currentTask.text;
    }

    // „Çø„Çπ„ÇØÂÆüË°åÂÆå‰∫Ü
    function executeTask() {
      if (!currentTask) return;

      tasks = tasks.filter(t => t !== currentTask);
      completedCount++;
      currentTask = null;
      currentTaskDiv.textContent = "ÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅÊ¨°„ÅÆ„Çø„Çπ„ÇØ„ÇíÂºï„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ";

      saveData();
      renderLists();
    }

    // „Çø„Çπ„ÇØ„Çπ„Ç≠„ÉÉ„Éó
    function skipTask() {
      if (!currentTask) return;

      currentTask.pending += 1;

      if (currentTask.pending >= 3) {
        trash.push(currentTask);
        tasks = tasks.filter(t => t !== currentTask);
        currentTaskDiv.textContent = "„Çπ„Ç≠„ÉÉ„Éó‰∏äÈôê„Å´„Çà„ÇäÂâäÈô§Ôºà„Ç¥„ÉüÁÆ±„Å∏Ôºâ";
      } else {
        currentTaskDiv.textContent = `‰øùÁïô‰∏≠Ôºà„Çπ„Ç≠„ÉÉ„Éó: ${currentTask.pending}/3Ôºâ`;
      }

      currentTask = null;
      saveData();
      renderLists();
    }

    // „Çø„Çπ„ÇØÂæ©Ê¥ª
    function restoreTask(index) {
      const task = trash.splice(index, 1)[0];
      task.pending = 0;
      tasks.push(task);

      saveData();
      renderLists();
    }

    // „Çø„Çπ„ÇØÂâäÈô§Ôºà„Ç¥„ÉüÁÆ±„Å∏Ôºâ
    function deleteTask(index) {
      if (confirm("„Åì„ÅÆ„Çø„Çπ„ÇØ„Çí„Ç¥„ÉüÁÆ±„Å´ÁßªÂãï„Åó„Åæ„Åô„ÅãÔºü")) {
        const task = tasks.splice(index, 1)[0];
        trash.push(task);

        if (currentTask === task) {
          currentTask = null;
          currentTaskDiv.textContent = "ÂâäÈô§„Åï„Çå„Åæ„Åó„Åü";
        }

        saveData();
        renderLists();
      }
    }

    // ÂÆåÂÖ®ÂâäÈô§
    function permanentDeleteTask(index) {
      if (confirm("„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) {
        trash.splice(index, 1);
        saveData();
        renderLists();
      }
    }

    // „É¢„Éº„ÉÄ„É´Èñã„ÅèÔºàËøΩÂä†Ôºâ
    function openAddModal() {
      editingTaskIndex = null;
      modalTitle.textContent = "„Çø„Çπ„ÇØ„ÇíËøΩÂä†";
      taskInput.value = "";
      taskModal.classList.add("active");
      taskInput.focus();
    }

    // „É¢„Éº„ÉÄ„É´Èñã„ÅèÔºàÁ∑®ÈõÜÔºâ
    function openEditModal(index) {
      editingTaskIndex = index;
      modalTitle.textContent = "„Çø„Çπ„ÇØ„ÇíÁ∑®ÈõÜ";
      taskInput.value = tasks[index].text;
      taskModal.classList.add("active");
      taskInput.focus();
    }

    // „É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã
    function closeTaskModal() {
      taskModal.classList.remove("active");
      taskInput.value = "";
      editingTaskIndex = null;
    }

    // „Çø„Çπ„ÇØ‰øùÂ≠ò
    function saveTask() {
      const text = taskInput.value.trim();

      if (!text) {
        alert("„Çø„Çπ„ÇØÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");
        return;
      }

      if (editingTaskIndex !== null) {
        // Á∑®ÈõÜ
        tasks[editingTaskIndex].text = text;
      } else {
        // Êñ∞Ë¶èËøΩÂä†
        tasks.push({text: text, pending: 0});
      }

      saveData();
      renderLists();
      closeTaskModal();
    }

    // Enter„Ç≠„Éº„Åß‰øùÂ≠ò
    taskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        saveTask();
      }
    });

    // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    taskModal.addEventListener("click", (e) => {
      if (e.target === taskModal) {
        closeTaskModal();
      }
    });

    habitModal.addEventListener("click", (e) => {
      if (e.target === habitModal) {
        closeHabitModal();
      }
    });

    // ÂàùÊúüÂåñÂÆüË°å
    init();
  </script>
</body>

</html>
